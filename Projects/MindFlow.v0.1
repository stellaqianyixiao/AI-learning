<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MindFlow v4 - çŒ«å’ªåé™¢ (æœ¬åœ°å›¾ç‰‡ç‰ˆ)</title>
    <style>
        :root {
            /* Cat Cafe Theme Colors */
            --primary: #e1b12c; /* æš–é»„ - ç½å¤´/é£Ÿç‰© */
            --secondary: #74b9ff; /* æŸ”è“ - ç©å…·/å¨±ä¹ */
            --accent: #ff7675; /* æŸ”ç²‰ - çŒ«å’ª/çˆ±å¿ƒ */
            --bg: #fff7e6; /* ç±³è‰²èƒŒæ™¯ */
            --card-bg: #ffffff;
            --text: #574b90; /* æ·±ç´«ç°æ–‡å­— */
            --gray: #b2bec3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 25px 15px;
            min-height: 100vh;
            box-sizing: border-box;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f3e0be' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .container {
            width: 100%;
            max-width: 480px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        /* æ ‡é¢˜åŒº */
        header { text-align: center; margin-bottom: 5px; }
        h1 { margin: 0; font-size: 1.8rem; color: var(--text); font-weight: 800; }
        p.subtitle { margin: 5px 0 0; color: var(--gray); font-size: 0.9rem; }

        /* å¡ç‰‡é€šç”¨ */
        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(87, 75, 144, 0.08);
            border: 2px solid #fff;
        }

        /* =========================================
           ç”»å»Šä¸èƒŒåŒ…åŒºåŸŸ
        ========================================= */
        .gallery-header {
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .count-badge {
            background: #f1f2f6;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--text);
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            background: #fcf8f2;
            padding: 12px;
            border-radius: 20px;
            min-height: 90px;
            border: 2px dashed #eee0cb;
            align-items: start;
            max-height: 200px;
            overflow-y: auto;
        }

        /* ç‰©å“é¡¹ */
        .collectible-item {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex; justify-content: center; align-items: center;
            font-size: 28px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid #f0f0f0;
            position: relative;
        }
        .collectible-item.food { border-color: var(--primary); background: #fffdf5; color: var(--primary); }
        .collectible-item.toy { border-color: var(--secondary); background: #f5fbff; color: var(--secondary); }
        
        /* çŒ«å’ªå¡ç‰‡ (åœ¨ä¹å›­ä¸­) */
        .cat-card {
            grid-column: span 2;
            height: 100px; /* ç¨å¾®è°ƒé«˜ä¸€ç‚¹ä»¥ä¾¿æ˜¾ç¤ºå›¾ç‰‡ */
            width: auto;
            border-radius: 18px;
            background-size: cover; background-position: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: bounceIn 0.6s;
            border: 3px solid #fff;
            position: relative;
            overflow: hidden;
            background-color: #eee; /* å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„åº•è‰² */
        }
        .cat-card-name {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.8);
            font-size: 0.75rem; padding: 4px; text-align: center;
            font-weight: bold; color: var(--text);
        }

        .empty-msg {
            grid-column: 1 / -1; text-align: center; color: var(--gray);
            font-size: 0.85rem; padding: 25px 0; opacity: 0.7;
        }

        /* å•†åº—æŒ‰é’® */
        .shop-btn-container { text-align: center; margin-top: 10px; }
        .shop-btn {
            background: var(--accent); color: white; border: none;
            padding: 12px 30px; border-radius: 30px;
            font-size: 1rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 6px 20px rgba(255, 118, 117, 0.3);
            transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px;
        }
        .shop-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255, 118, 117, 0.4); }
        .shop-btn:disabled { background: var(--gray); box-shadow: none; opacity: 0.7; cursor: not-allowed; transform: none;}


        /* ä»»åŠ¡åŒº & å¤šå·´èƒºåŒº */
        .input-group input { border: 2px solid #eee0cb; background: #fffcf9; }
        .input-group input:focus { border-color: var(--primary); }
        .add-btn { background: var(--primary); box-shadow: 0 4px 15px rgba(225, 177, 44, 0.3); }
        .add-btn:hover { background: #cd9f25; }
        li .check-circle { border-color: var(--primary); }
        li:hover .check-circle { background: rgba(225, 177, 44, 0.2); }
        
        .dopamine-card { background: linear-gradient(135deg, #eaf4fc 0%, #f3eefc 100%); }
        .dopamine-btn { box-shadow:0 4px 10px rgba(0,0,0,0.05); }


        /* å•†åº— Modal */
        #shop-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            justify-content: center; align-items: end;
        }
        .modal-content {
            background: #fff; width: 100%; max-width: 480px;
            border-radius: 24px 24px 0 0; padding: 25px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
            animation: slideUp 0.3s cubic-bezier(0.25, 0.8, 0.5, 1);
            max-height: 80vh; overflow-y: auto;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { margin: 0; font-size: 1.4rem; color: var(--text); }
        .close-btn { background: #f1f2f6; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; color: var(--gray);}

        /* å•†åº—å•†å“åˆ—è¡¨ */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .shop-item {
            background: #fcf8f2; border-radius: 18px; padding: 15px;
            text-align: center; border: 2px solid #eee0cb;
            transition: all 0.2s; position: relative;
            opacity: 0.8;
        }
        .shop-item.affordable { opacity: 1; border-color: var(--accent); background: #fff5f5; cursor: pointer; }
        .shop-item.affordable:hover { transform: translateY(-5px); }

        .shop-cat-img {
            width: 100%; height: 100px; border-radius: 12px;
            background-size: cover; background-position: center; margin-bottom: 10px;
            background-color: #eee;
        }
        .shop-cat-name { font-weight: bold; margin-bottom: 8px; color: var(--text); }
        .shop-cat-price {
            display: flex; justify-content: center; gap: 8px;
            font-size: 0.9rem; color: var(--gray); font-weight: 600;
        }
        .price-tag { display: flex; align-items: center; gap: 4px; }
        .affordable .price-tag { color: var(--accent); }

        /* åŠ¨ç”» */
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.15); } 100% { transform: scale(1); } }
        @keyframes bounceIn { 0%, 20%, 40%, 60%, 80%, 100% {transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);} 0% {opacity: 0; transform: scale3d(.3, .3, .3);} 20% {transform: scale3d(1.1, 1.1, 1.1);} 40% {transform: scale3d(.9, .9, .9);} 60% {opacity: 1; transform: scale3d(1.03, 1.03, 1.03);} 80% {transform: scale3d(.97, .97, .97);} 100% {opacity: 1; transform: scale3d(1, 1, 1);} }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<canvas id="confetti-canvas" style="position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1001;"></canvas>

<div class="container">
    <header>
        <h1>ğŸ± MindFlow çŒ«å’ªåé™¢</h1>
        <p class="subtitle">å®Œæˆä»»åŠ¡æŒ£çŒ«ç²®ï¼Œå¨±ä¹ä¼‘æ¯æ”’ç©å…·</p>
    </header>

    <div class="card" style="background: #fffdf5;">
        <div class="gallery-header" style="color: var(--accent);">
            <span>ğŸ¡ æˆ‘çš„çŒ«å’ªä¹å›­</span>
            <span class="count-badge" id="cat-count-badge">0 åª</span>
        </div>
        <div id="cat-garden" class="visual-grid" style="border-color: #ffeaa7;">
            <div class="empty-msg" id="empty-garden">
                è¿˜æ²¡æœ‰çŒ«å’ªå“¦...<br>å¿«å»å•†åº—å…‘æ¢ä¸€åªå§ï¼
            </div>
        </div>
    </div>

    <div class="card">
        <div class="gallery-header" style="color: var(--text);">
            <span>ğŸ’ æˆ‘çš„èƒŒåŒ… (èµ„æº)</span>
            <div style="display: flex; gap:10px;">
                <span class="count-badge" style="color:var(--primary)">ğŸŸ <span id="food-count">0</span></span>
                <span class="count-badge" style="color:var(--secondary)">ğŸ§¶ <span id="toy-count">0</span></span>
            </div>
        </div>
        <div id="inventory-gallery" class="visual-grid">
             <div class="empty-msg" id="empty-inventory">
                èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿã€‚<br>å®Œæˆä»»åŠ¡è·å¾—é£Ÿç‰©ï¼Œä¼‘æ¯è·å¾—ç©å…·ã€‚
            </div>
        </div>
        <div class="shop-btn-container">
            <button id="open-shop-btn" class="shop-btn" onclick="openShop()" disabled>
                ğŸª å‰å¾€å•†åº—å…‘æ¢çŒ«å’ª
            </button>
        </div>
    </div>

    <div class="card">
        <div class="input-group" style="display: flex; gap: 12px;">
            <input type="text" id="taskInput" placeholder="ä¸ºäº†çŒ«ä¸»å­ï¼Œä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼Ÿ" onkeypress="handleEnter(event)" style="flex:1; padding: 15px; border-radius: 16px; border: 2px solid #eee; outline:none;">
            <button class="add-btn" onclick="addTask()" style="width: 54px; border-radius: 16px; border:none; background:var(--primary); color:white; font-size:1.5rem; cursor:pointer;">ğŸŸ</button>
        </div>
        <ul id="taskList" style="list-style:none; padding:0; margin-top:20px;"></ul>
    </div>

    <div class="card dopamine-card">
        <h3 style="margin-top: 0; text-align:center; color: #574b90;">ğŸ§¶ æ‘¸é±¼/ä¼‘æ¯ä¸€ä¸‹</h3>
        <div id="dopamine-result" style="text-align:center; margin: 15px 0; min-height: 24px; font-weight:bold; color:var(--secondary);">å‡†å¤‡å¥½æ”¶é›†ç©å…·äº†å—ï¼Ÿ</div>
        <div class="dopamine-options" style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
            <button class="dopamine-btn" onclick="getDopamine('quick')" data-type="energy" style="background:#fff; border:none; padding:10px 16px; border-radius:20px; font-weight:bold; cursor:pointer;"><span>âš¡</span> å¿«é€Ÿå……èƒ½</button>
            <button class="dopamine-btn" onclick="getDopamine('deep')" data-type="calm" style="background:#fff; border:none; padding:10px 16px; border-radius:20px; font-weight:bold; cursor:pointer;"><span>ğŸ§˜â€â™€ï¸</span> æ·±åº¦ä¼‘æ¯</button>
            <button class="dopamine-btn" onclick="getDopamine('treat')" data-type="treat" style="background:#fff; border:none; padding:10px 16px; border-radius:20px; font-weight:bold; cursor:pointer;"><span>ğŸ®</span> çº¯ç²¹å¨±ä¹</button>
        </div>
    </div>
</div>

<div id="shop-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">ğŸª çŒ«å’ªå•†åº—</h2>
            <button class="close-btn" onclick="closeShop()">âœ•</button>
        </div>
        <div class="shop-grid" id="shop-list"></div>
    </div>
</div>

<script>
    // === æ•°æ®çŠ¶æ€ ===
    let inventory = { food: 0, toy: 0 };
    let ownedCats = [];
    const foodIcons = ['ğŸŸ', 'ğŸ¥«', 'ğŸ¥©'];
    const toyIcons = ['ğŸ§¶', 'ğŸ', 'ğŸª¶', 'ğŸ¾'];

    // === 1. è‡ªå®šä¹‰ä½ çš„çŒ«å’ªå›¾ç‰‡ ===
    // è¯·ç¡®ä¿ä½ åœ¨ html æ–‡ä»¶æ—è¾¹åˆ›å»ºäº† images æ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾å…¥äº†å¯¹åº”åå­—çš„ jpg å›¾ç‰‡
    const catShopData = [
        { id: 'persian', name: 'æ³¢æ–¯çŒ«', price: { food: 3, toy: 2 }, image: './images/persian.jpg' },
        { id: 'siamese', name: 'æš¹ç½—çŒ«', price: { food: 3, toy: 3 }, image: './images/siamese.jpg' },
        { id: 'maine', name: 'ç¼…å› çŒ«', price: { food: 5, toy: 3 }, image: './images/maine.jpg' },
        { id: 'bengal', name: 'å­ŸåŠ æ‹‰çŒ«', price: { food: 4, toy: 5 }, image: './images/bengal.jpg' },
        { id: 'ragdoll', name: 'å¸ƒå¶çŒ«', price: { food: 6, toy: 4 }, image: './images/ragdoll.jpg' },
        { id: 'british', name: 'è‹±çŸ­è“çŒ«', price: { food: 4, toy: 4 }, image: './images/british.jpg' }
    ];
    
    // === æ ¸å¿ƒé€»è¾‘ ===
    function addTask() {
        const input = document.getElementById('taskInput');
        const text = input.value.trim();
        if (text) {
            const li = document.createElement('li');
            li.innerHTML = `<div style="display:flex; align-items:center; font-weight: 500;"><div class="check-circle" style="width:20px; height:20px; border:2px solid var(--primary); border-radius:50%; margin-right:12px;"></div><span>${text}</span></div>`;
            li.style.cssText = "background:#fff; padding:15px; margin-bottom:10px; border-radius:16px; display:flex; align-items:center; cursor:pointer; transition:all 0.2s; border:1px solid #f0f0f0;";
            li.onclick = function() { completeTask(li); };
            document.getElementById('taskList').prepend(li);
            input.value = ''; input.focus();
        }
    }

    function completeTask(element) {
        fireConfetti(['#e1b12c', '#f1c40f']);
        element.style.transform = "scale(1.02) translateX(10px)";
        element.style.background = "#fffdf5"; element.style.borderColor = "var(--primary)";
        setTimeout(() => {
            element.style.opacity = "0"; element.style.transform = "scale(0.8) translateY(-20px)";
            setTimeout(() => element.remove(), 300);
        }, 200);
        addResource('food');
    }

    const menus = {
        quick: { items: ["å–æ°´", "ä¼¸æ‡’è…°", "è¿œçœº", "å¬é¦–å¿«æ­Œ"], icon: 'âš¡' },
        deep:  { items: ["æ•£æ­¥", "å†¥æƒ³", "é˜…è¯»ä¸€ç« ", "æ•´ç†æ¡Œé¢"], icon: 'ğŸ§˜â€â™€ï¸' },
        treat: { items: ["çœ‹ä¸ªæç¬‘è§†é¢‘", "åƒä¸ªé›¶é£Ÿ", "åˆ·ä¼šå„¿æ‰‹æœº", "å‘å‘†"], icon: 'ğŸ®' }
    };

    function getDopamine(type) {
        const category = menus[type];
        const randomItem = category.items[Math.floor(Math.random() * category.items.length)];
        const display = document.getElementById('dopamine-result');
        display.style.opacity = 0;
        setTimeout(() => {
            display.innerHTML = `${category.icon} å»ºè®®ï¼š${randomItem}`;
            display.style.opacity = 1;
        }, 200);
        addResource('toy');
    }

    function addResource(type) {
        inventory[type]++;
        updateInventoryUI();
        const gallery = document.getElementById('inventory-gallery');
        document.getElementById('empty-inventory').style.display = 'none';
        const item = document.createElement('div');
        item.className = `collectible-item ${type}`;
        const iconSet = type === 'food' ? foodIcons : toyIcons;
        item.innerText = iconSet[Math.floor(Math.random() * iconSet.length)];
        gallery.appendChild(item);
        gallery.scrollTop = gallery.scrollHeight;
    }

    function updateInventoryUI() {
        document.getElementById('food-count').innerText = inventory.food;
        document.getElementById('toy-count').innerText = inventory.toy;
        const canAffordAnything = catShopData.some(cat => inventory.food >= cat.price.food && inventory.toy >= cat.price.toy);
        const shopBtn = document.getElementById('open-shop-btn');
        shopBtn.disabled = !canAffordAnything;
        if(canAffordAnything) {
             shopBtn.innerHTML = "ğŸª å‰å¾€å•†åº—å…‘æ¢çŒ«å’ª (æœ‰æ–°å“!)";
             shopBtn.style.animation = "bounceIn 0.5s";
        } else {
             shopBtn.innerHTML = "ğŸª å‰å¾€å•†åº—å…‘æ¢çŒ«å’ª";
             shopBtn.style.animation = "none";
        }
    }

    // === å•†åº—ç³»ç»Ÿ (å·²ä¿®æ”¹ä¸ºæ”¯æŒæœ¬åœ°å›¾ç‰‡) ===
    function openShop() {
        const modal = document.getElementById('shop-modal');
        const list = document.getElementById('shop-list');
        list.innerHTML = '';
        catShopData.forEach(cat => {
            const affordable = inventory.food >= cat.price.food && inventory.toy >= cat.price.toy;
            const item = document.createElement('div');
            item.className = `shop-item ${affordable ? 'affordable' : ''}`;
            if(affordable) {
                item.onclick = () => redeemCat(cat);
            }
            // ä½¿ç”¨é…ç½®å¥½çš„ image è·¯å¾„ï¼Œå¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼ˆæ¯”å¦‚ä½ è¿˜æ²¡æ”¾å›¾ç‰‡ï¼‰ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªç°è‰²å—
            item.innerHTML = `
                <div class="shop-cat-img" style="background-image: url('${cat.image}')"></div>
                <div class="shop-cat-name">${cat.name}</div>
                <div class="shop-cat-price">
                    <span class="price-tag">ğŸŸ ${cat.price.food}</span>
                    <span class="price-tag">ğŸ§¶ ${cat.price.toy}</span>
                </div>
            `;
            list.appendChild(item);
        });
        modal.style.display = 'flex';
    }

    function closeShop() { document.getElementById('shop-modal').style.display = 'none'; }

    function redeemCat(cat) {
        inventory.food -= cat.price.food;
        inventory.toy -= cat.price.toy;
        updateInventoryUI();
        ownedCats.push(cat);
        const garden = document.getElementById('cat-garden');
        document.getElementById('empty-garden').style.display = 'none';
        
        const catCard = document.createElement('div');
        catCard.className = 'cat-card';
        // ä½¿ç”¨é…ç½®å¥½çš„ image è·¯å¾„
        catCard.style.backgroundImage = `url('${cat.image}')`;
        catCard.innerHTML = `<div class="cat-card-name">${cat.name}</div>`;
        
        garden.appendChild(catCard);
        document.getElementById('cat-count-badge').innerText = ownedCats.length + " åª";
        closeShop();
        setTimeout(() => fireConfetti(['#ff7675', '#e1b12c', '#74b9ff']), 300);
    }

    function handleEnter(e) { if (e.key === 'Enter') addTask(); }

    function fireConfetti(colors) {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const pieces = [];
        for (let i = 0; i < 80; i++) {
            pieces.push({
                x: window.innerWidth / 2, y: window.innerHeight / 2,
                w: Math.random()*8+5, h: Math.random()*8+5,
                color: colors[Math.floor(Math.random() * colors.length)],
                vx: (Math.random()-0.5)*30, vy: (Math.random()-0.5)*30, gravity: 1
            });
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let active = false;
            pieces.forEach(p => {
                p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity;
                if (p.y < canvas.height) active = true;
                ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.w, p.h);
            });
            if (active) requestAnimationFrame(draw); else ctx.clearRect(0,0,canvas.width,canvas.height);
        }
        draw();
    }
</script>
</body>
</html>
